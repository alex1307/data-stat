# Server Deployment

## Summary

The vehicle-data app offers a comprehensive solution for gathering, processing, and searching through classified car deals.
By leveraging the power of the Rust polars crate, it efficiently handles large datasets, enabling advanced statistical
analysis and filtering of car deals based on various criteria. This app is essential for anyone looking to analyze
and find the best car deals with high performance and accuracy.

## Prerequisites

Before deploying to the server, ensure that the necessary CSV files are generated and the executable is built. Hereâ€™s what you need:

1. **CSV Files**:
    - The files `resources/Prices.csv`, `resources/EstimatedPrices.csv`, and `resources/Vehicles.csv` must be generated from the database.
    - This process is automated through the `generate_csv_files.sh` script.

2. **Executable**:
    - For **UNIX-based systems**, the executable is generated by running:

      ```bash
      TARGET_CC=x86_64-linux-musl-gcc cargo build --release --target x86_64-unknown-linux-musl
      ```

    - For **iOS**, generate the executable by running:

      ```bash
      cargo build --release
      ```

## Deploy on Production (PROD)

### Step 1: Generate CSV Files

- To extract data from the database views and save them as CSV files, run:

  ```bash
  ./generate_csv_files.sh
  ```

- What this script does:
  - Connects to the PostgreSQL database and exports data from the `views` schema.
  - Saves the data into corresponding CSV files (`Prices.csv`, `EstimatedPrices.csv`, and `Vehicles.csv`).
  - Cleans the CSV files by removing all occurrences of the `"` character.

### Step 2: Deploy Files and Restart the Service

- To deploy the generated files to the production server and restart the service, run:

  ```bash
  ./deploy.sh
  ```

- Script behavior:
  - **With `--all` parameter**:
    - The script will build a new executable `vehicle-data`.
    - It then copies the executable and the CSV files to the production server.
    - Finally, it restarts the server daemon.
  - **Without `--all` parameter**:
    - The script will only copy the CSV files from the `resources/` directory to the production server.
    - It then restarts the server daemon.

### Summary

By following the steps outlined above, you can ensure that the necessary data and executable are properly prepared and deployed to your production environment. The deployment scripts are designed to automate the process, making it efficient and reducing the potential for manual errors.
